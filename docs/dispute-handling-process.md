# 支付争议处理流程 (Chargeback Handling)

## 1. 什么是支付争议

支付争议（也称为"退单"或 Chargeback）是当持卡人就其信用卡账单上的一笔交易向其发卡行提出异议时启动的流程。争议的原因可能包括未经授权的交易、服务未收到、产品与描述不符等。

处理争议是维护平台财务健康和商誉的关键环节。

## 2. 争议通知流程

我们通过 **Creem Webhook** 自动接收争议通知。

1.  当用户发起争议时，Creem 会向我们的系统发送一个类型为 `charge.dispute.created` 的 Webhook 事件。
2.  我们的 Webhook 处理器 (`/api/webhooks/creem`) 会接收此事件。
3.  系统会自动在后台日志中记录一条 **CRITICAL** 级别的错误信息，其中包含争议的详细信息（如原始支付ID、金额、原因）。
4.  **此日志会触发监控系统的警报，通知管理员需要立即进行人工干预。**

## 3. 管理员操作手册 (SOP)

一旦收到争议警报，管理员必须严格遵循以下步骤：

### 步骤 1: 立即响应与初步调查

1.  **登录 Creem 控制台**: 导航至"争议"页面，找到警报中提到的争议记录。
2.  **查看争议详情**: 了解争议原因（如 `fraudulent`, `product_not_received` 等）和截止日期。
3.  **查找关联用户**: 使用争议中的支付ID (`charge_id`) 在我们自己的数据库 `payments` 表中查找对应的 `user_id`。
4.  **(可选) 暂停用户账户**: 为防止用户在争议期间继续消耗通过可能无效的支付获得的积分，应考虑暂时限制该用户的翻译功能。

### 步骤 2: 收集证据

根据争议原因，收集强有力的证据来反驳用户的声明。需要收集的证据包括但不限于：

-   **用户身份证明**:
    -   用户注册时使用的邮箱地址。
    -   用户的登录历史记录，包括 IP 地址和时间戳。
-   **服务交付证明**:
    -   `payments` 表中的成功支付记录。
    -   `credit_transactions` 表中与该笔支付关联的积分充值记录。
    -   该用户在购买积分后的翻译历史（`credit_transactions` 表中类型为 `consume` 的记录），证明积分已被使用。
-   **服务条款与政策**:
    -   用户注册时同意的服务条款和隐私政策的截图。
    -   清晰展示我们退款政策的页面截图。
-   **与用户的沟通记录**:
    -   任何与该用户相关的客服邮件或沟通记录。

### 步骤 3: 提交证据

1.  **整理证据**: 将所有收集到的证据整理成清晰、简洁的文档或说明。使用简明扼要的语言，突出关键点。
2.  **通过 Creem 控制台提交**: 在 Creem 的争议详情页面，按照指引上传证据文件并提交反驳声明。
3.  **在截止日期前完成**: **务必在 Creem 提供的截止日期之前提交所有证据。**

### 步骤 4: 跟踪与处理结果

1.  **等待裁决**: 提交证据后，发卡行将对争议进行裁决。此过程可能需要数周甚至数月。
2.  **处理结果**:
    -   **争议胜利 (Dispute Won)**: 无需进一步操作。资金将返还给我们。可以考虑恢复用户的账户权限。
    -   **争议失败 (Dispute Lost)**: 资金将退还给持卡人。我们系统中的积分状态无需改变（因为在退款流程中已经扣除）。将此案例记录在案，以备未来分析。

## 4. 预防措施

-   提供清晰的定价和产品描述。
-   确保服务稳定可靠。
-   提供易于访问的客户支持和清晰的退款政策。
-   在银行对账单上使用清晰可辨的商户名称。 