<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>并行翻译测试页面</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            color: #2563eb;
            margin-bottom: 10px;
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
        }
        
        .test-section h3 {
            color: #374151;
            margin-bottom: 15px;
        }
        
        textarea {
            width: 100%;
            min-height: 150px;
            padding: 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            resize: vertical;
        }
        
        .controls {
            display: flex;
            gap: 15px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        select, button {
            padding: 8px 16px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
        }
        
        button {
            background: #2563eb;
            color: white;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        button:hover:not(:disabled) {
            background: #1d4ed8;
        }
        
        button:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }
        
        .result-area {
            margin-top: 15px;
        }
        
        .result-text {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            padding: 12px;
            min-height: 100px;
            white-space: pre-wrap;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .stat-card {
            background: #f3f4f6;
            padding: 12px;
            border-radius: 6px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #2563eb;
        }
        
        .stat-label {
            font-size: 12px;
            color: #6b7280;
            margin-top: 4px;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: #2563eb;
            transition: width 0.3s ease;
        }
        
        .chunk-details {
            margin-top: 15px;
        }
        
        .chunk-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            margin: 4px 0;
            background: #f9fafb;
            border-radius: 4px;
            font-size: 12px;
        }
        
        .chunk-success {
            border-left: 4px solid #10b981;
        }
        
        .chunk-failed {
            border-left: 4px solid #ef4444;
        }
        
        .status-indicator {
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: bold;
        }
        
        .status-success {
            background: #d1fae5;
            color: #065f46;
        }
        
        .status-failed {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #e5e7eb;
            border-top: 2px solid #2563eb;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .alert {
            padding: 12px;
            border-radius: 6px;
            margin: 15px 0;
        }
        
        .alert-info {
            background: #dbeafe;
            border: 1px solid #93c5fd;
            color: #1e40af;
        }
        
        .alert-success {
            background: #d1fae5;
            border: 1px solid #6ee7b7;
            color: #065f46;
        }
        
        .alert-error {
            background: #fee2e2;
            border: 1px solid #fca5a5;
            color: #991b1b;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🚀 并行翻译测试工具</h1>
            <p>测试长文本的并行分块处理和重试机制</p>
        </div>

        <!-- 测试用例选择 -->
        <div class="test-section">
            <h3>📋 预设测试用例</h3>
            <div class="controls">
                <select id="testCaseSelect">
                    <option value="">选择测试用例...</option>
                    <option value="short">短文本测试 (单块)</option>
                    <option value="medium">中等文本测试 (2-3块)</option>
                    <option value="long">长文本测试 (5+块)</option>
                    <option value="very-long">超长文本测试 (10+块)</option>
                </select>
                <button onclick="loadTestCase()">加载测试用例</button>
            </div>
        </div>

        <!-- 翻译配置 -->
        <div class="test-section">
            <h3>⚙️ 翻译配置</h3>
            <div class="controls">
                <select id="sourceLang">
                    <option value="en">English</option>
                    <option value="zh">中文</option>
                    <option value="es">Español</option>
                    <option value="fr">Français</option>
                </select>
                <span>→</span>
                <select id="targetLang">
                    <option value="zh">中文</option>
                    <option value="en">English</option>
                    <option value="es">Español</option>
                    <option value="fr">Français</option>
                </select>
                <select id="apiEndpoint">
                    <option value="/api/translate-parallel">并行翻译 API</option>
                    <option value="/api/translate">顺序翻译 API</option>
                    <option value="/api/translate-simple">简单翻译 API</option>
                </select>
            </div>
        </div>

        <!-- 文本输入 -->
        <div class="test-section">
            <h3>📝 输入文本</h3>
            <textarea id="sourceText" placeholder="在此输入要翻译的文本..."></textarea>
            <div class="controls">
                <span id="charCount">0 字符</span>
                <span id="translationMode">翻译模式：待确定</span>
                <button onclick="startTranslation()" id="translateBtn">开始翻译</button>
                <button onclick="clearAll()">清空</button>
            </div>
        </div>

        <!-- 翻译进度 -->
        <div class="test-section" id="progressSection" style="display: none;">
            <h3>📊 翻译进度</h3>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%;"></div>
            </div>
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-value" id="totalChunks">0</div>
                    <div class="stat-label">总块数</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="processedChunks">0</div>
                    <div class="stat-label">已处理</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="successChunks">0</div>
                    <div class="stat-label">成功</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="failedChunks">0</div>
                    <div class="stat-label">失败</div>
                </div>
            </div>
        </div>

        <!-- 翻译结果 -->
        <div class="test-section">
            <h3>📄 翻译结果</h3>
            <div class="result-text" id="resultText">翻译结果将在此显示...</div>
            <div class="controls">
                <button onclick="copyResult()">复制结果</button>
                <button onclick="downloadResult()">下载结果</button>
            </div>
        </div>

        <!-- 详细统计 -->
        <div class="test-section" id="detailsSection" style="display: none;">
            <h3>📈 详细统计</h3>
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-value" id="processingTime">0</div>
                    <div class="stat-label">处理时间 (ms)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="avgTimePerChunk">0</div>
                    <div class="stat-label">平均时间/块 (ms)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="successRate">0</div>
                    <div class="stat-label">成功率 (%)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="translationRatio">0</div>
                    <div class="stat-label">翻译比率</div>
                </div>
            </div>
            
            <div class="chunk-details" id="chunkDetails">
                <!-- 块详情将在此显示 -->
            </div>
        </div>
    </div>

    <script>
        // 测试用例数据
        const testCases = {
            short: {
                text: "Hello world! This is a simple test to verify the translation functionality.",
                description: "短文本测试 - 单块处理"
            },
            medium: {
                text: `Artificial intelligence (AI) is intelligence demonstrated by machines, in contrast to the natural intelligence displayed by humans and animals. Leading AI textbooks define the field as the study of "intelligent agents": any device that perceives its environment and takes actions that maximize its chance of successfully achieving its goals. Colloquially, the term "artificial intelligence" is often used to describe machines that mimic "cognitive" functions that humans associate with the human mind, such as "learning" and "problem solving".`,
                description: "中等文本测试 - 2-3块处理"
            },
            long: {
                text: `Machine learning (ML) is a type of artificial intelligence (AI) that allows software applications to become more accurate at predicting outcomes without being explicitly programmed to do so. Machine learning algorithms use historical data as input to predict new output values.

The process of machine learning is similar to that of data mining. Both systems search through data to look for patterns. However, instead of extracting data for human comprehension — as is the case in data mining applications — machine learning uses that data to detect patterns in data and adjust program actions accordingly.

Machine learning algorithms are typically created using frameworks that accelerate solution development, such as TensorFlow and PyTorch. The amount of data generated today, by both humans and machines, far outpaces humans' ability to absorb, interpret, and make complex decisions based on that data.

Machine learning, which is a subset of artificial intelligence (AI), is the area of computational science that focuses on analyzing and interpreting patterns and structures in data to enable learning, reasoning, and decision making outside of human interaction.

In simple terms, machine learning is a method of teaching computers to make predictions or take actions based on data. Instead of being explicitly programmed with rules, the computer learns patterns from examples and uses those patterns to make decisions about new, unseen data.`,
                description: "长文本测试 - 5+块处理"
            },
            'very-long': {
                text: `The field of artificial intelligence has experienced remarkable growth and transformation over the past decade. From simple rule-based systems to sophisticated neural networks, AI has evolved to tackle increasingly complex problems across various domains.

Machine learning, a subset of AI, has been particularly revolutionary. It enables computers to learn and improve from experience without being explicitly programmed for every scenario. This capability has opened up new possibilities in areas such as natural language processing, computer vision, and predictive analytics.

Deep learning, which uses neural networks with multiple layers, has achieved breakthrough results in image recognition, speech processing, and game playing. The success of deep learning models like GPT, BERT, and ResNet has demonstrated the power of large-scale neural architectures trained on massive datasets.

However, with great power comes great responsibility. As AI systems become more capable and widespread, concerns about ethics, bias, privacy, and job displacement have become increasingly important. The AI community is actively working on developing responsible AI practices and ensuring that these technologies benefit humanity as a whole.

Looking forward, the future of AI holds immense promise. Emerging areas like quantum machine learning, neuromorphic computing, and artificial general intelligence represent the next frontiers in this rapidly evolving field. The integration of AI with other technologies such as robotics, IoT, and blockchain will likely create new paradigms and applications we can barely imagine today.

Natural language processing (NLP) has seen tremendous advances with the introduction of transformer architectures. Models like GPT-3 and GPT-4 have demonstrated remarkable capabilities in text generation, translation, and comprehension. These models can engage in human-like conversations, write creative content, and even assist with complex reasoning tasks.

Computer vision has also made significant strides, with applications ranging from autonomous vehicles to medical imaging. Convolutional neural networks (CNNs) and vision transformers have enabled machines to recognize objects, understand scenes, and even generate realistic images from textual descriptions.

The democratization of AI tools and platforms has made it possible for individuals and small organizations to leverage powerful AI capabilities without requiring extensive technical expertise. Cloud-based AI services, pre-trained models, and user-friendly interfaces have lowered the barriers to entry and accelerated innovation across industries.

As we continue to push the boundaries of what's possible with AI, it's crucial to maintain a balance between innovation and responsibility. The development of AI systems must be guided by principles of fairness, transparency, and accountability to ensure that these powerful technologies serve the greater good and contribute to a more equitable and prosperous future for all.`,
                description: "超长文本测试 - 10+块处理"
            }
        };

        let currentTranslation = null;

        // 加载测试用例
        function loadTestCase() {
            const select = document.getElementById('testCaseSelect');
            const testCase = testCases[select.value];
            if (testCase) {
                document.getElementById('sourceText').value = testCase.text;
                updateCharCount();
                showAlert('info', `已加载：${testCase.description}`);
            }
        }

        // 更新字符计数
        function updateCharCount() {
            const text = document.getElementById('sourceText').value;
            const charCount = text.length;
            document.getElementById('charCount').textContent = `${charCount} 字符`;
            
            // 确定翻译模式
            let mode = '顺序处理';
            if (charCount > 1000) {
                mode = '并行处理';
            }
            if (charCount > 2000) {
                mode = '强制并行处理';
            }
            document.getElementById('translationMode').textContent = `翻译模式：${mode}`;
        }

        // 开始翻译
        async function startTranslation() {
            const sourceText = document.getElementById('sourceText').value.trim();
            if (!sourceText) {
                showAlert('error', '请输入要翻译的文本');
                return;
            }

            const sourceLang = document.getElementById('sourceLang').value;
            const targetLang = document.getElementById('targetLang').value;
            const endpoint = document.getElementById('apiEndpoint').value;

            // 重置UI
            resetUI();
            document.getElementById('translateBtn').disabled = true;
            document.getElementById('translateBtn').innerHTML = '<span class="loading"></span> 翻译中...';
            document.getElementById('progressSection').style.display = 'block';

            try {
                const startTime = Date.now();
                
                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        text: sourceText,
                        sourceLang: sourceLang,
                        targetLang: targetLang
                    })
                });

                const result = await response.json();
                const endTime = Date.now();
                const totalTime = endTime - startTime;

                if (!response.ok) {
                    throw new Error(result.error || '翻译失败');
                }

                // 显示结果
                displayResult(result, totalTime);
                showAlert('success', '翻译完成！');

            } catch (error) {
                console.error('Translation error:', error);
                showAlert('error', `翻译失败：${error.message}`);
            } finally {
                document.getElementById('translateBtn').disabled = false;
                document.getElementById('translateBtn').textContent = '开始翻译';
            }
        }

        // 显示翻译结果
        function displayResult(result, totalTime) {
            currentTranslation = result;
            
            // 显示翻译文本
            document.getElementById('resultText').textContent = result.translatedText;
            
            // 更新进度
            if (result.chunkResults) {
                updateProgress(result);
                document.getElementById('detailsSection').style.display = 'block';
                displayDetailedStats(result, totalTime);
                displayChunkDetails(result.chunkResults);
            } else {
                // 单块处理
                updateProgress({
                    chunksProcessed: 1,
                    successCount: 1,
                    failedCount: 0
                });
            }
        }

        // 更新进度显示
        function updateProgress(result) {
            const progress = 100;
            document.getElementById('progressFill').style.width = `${progress}%`;
            
            document.getElementById('totalChunks').textContent = result.chunksProcessed || 1;
            document.getElementById('processedChunks').textContent = result.chunksProcessed || 1;
            document.getElementById('successChunks').textContent = result.successCount || 1;
            document.getElementById('failedChunks').textContent = result.failedCount || 0;
        }

        // 显示详细统计
        function displayDetailedStats(result, totalTime) {
            const processingTime = result.processingTime || totalTime;
            const avgTime = processingTime / (result.chunksProcessed || 1);
            const successRate = ((result.successCount || 1) / (result.chunksProcessed || 1) * 100).toFixed(1);
            const translationRatio = (result.translatedText.length / result.characterCount).toFixed(2);
            
            document.getElementById('processingTime').textContent = processingTime;
            document.getElementById('avgTimePerChunk').textContent = Math.round(avgTime);
            document.getElementById('successRate').textContent = successRate;
            document.getElementById('translationRatio').textContent = translationRatio;
        }

        // 显示块详情
        function displayChunkDetails(chunkResults) {
            const container = document.getElementById('chunkDetails');
            container.innerHTML = '<h4>块处理详情：</h4>';
            
            chunkResults.forEach(chunk => {
                const div = document.createElement('div');
                div.className = `chunk-item ${chunk.status === 'success' ? 'chunk-success' : 'chunk-failed'}`;
                
                div.innerHTML = `
                    <span>块 ${chunk.index}</span>
                    <span>${chunk.originalLength} → ${chunk.translatedLength} 字符</span>
                    <span>${chunk.attempts} 次尝试</span>
                    <span class="status-indicator status-${chunk.status}">${chunk.status}</span>
                `;
                
                if (chunk.error) {
                    div.title = `错误：${chunk.error}`;
                }
                
                container.appendChild(div);
            });
        }

        // 重置UI
        function resetUI() {
            document.getElementById('progressSection').style.display = 'none';
            document.getElementById('detailsSection').style.display = 'none';
            document.getElementById('resultText').textContent = '翻译结果将在此显示...';
            document.getElementById('progressFill').style.width = '0%';
        }

        // 显示提示
        function showAlert(type, message) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.textContent = message;
            
            document.querySelector('.container').insertBefore(alertDiv, document.querySelector('.test-section'));
            
            setTimeout(() => {
                alertDiv.remove();
            }, 5000);
        }

        // 复制结果
        function copyResult() {
            if (currentTranslation) {
                navigator.clipboard.writeText(currentTranslation.translatedText);
                showAlert('success', '结果已复制到剪贴板');
            }
        }

        // 下载结果
        function downloadResult() {
            if (currentTranslation) {
                const blob = new Blob([currentTranslation.translatedText], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'translation-result.txt';
                a.click();
                URL.revokeObjectURL(url);
            }
        }

        // 清空所有内容
        function clearAll() {
            document.getElementById('sourceText').value = '';
            document.getElementById('testCaseSelect').value = '';
            resetUI();
            updateCharCount();
        }

        // 事件监听
        document.getElementById('sourceText').addEventListener('input', updateCharCount);
        
        // 初始化
        updateCharCount();
    </script>
</body>
</html>
